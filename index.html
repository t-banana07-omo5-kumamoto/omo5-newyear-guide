<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OMO5熊本：年末年始ご近所ガイド 2025-2026</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --omo-black: #1c1917;
      --omo-gold: #d97706;
      --omo-red:  #991b1b;
      --omo-bg:   #fafaf9;
    }
    body { font-family: 'Noto Sans JP', sans-serif; background-color: var(--omo-bg); color: var(--omo-black); }
    .chart-container { position: relative; width: 100%; height: 240px; margin: auto; }
    .date-active { background-color: var(--omo-red) !important; color: white !important; transform: scale(1.05); }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>

<body class="min-h-screen">

  <!-- Header -->
  <header class="relative overflow-hidden">
    <div class="bg-gradient-to-br from-stone-950 via-stone-900 to-amber-900 rounded-b-[3rem] pt-10 pb-20 px-4">
      <div class="max-w-4xl mx-auto">
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-amber-500/10 border border-amber-500/30 text-amber-300 text-xs font-bold tracking-wider mb-6">
          <span>OMO5 KUMAMOTO NEIGHBORHOOD GUIDE</span>
        </div>

        <h1 class="text-3xl md:text-5xl font-black leading-tight mb-3">
          年末年始<br><span class="text-amber-500">ご近所営業マップ</span><br>
          <span class="text-white/50 text-2xl md:text-3xl">2025-2026</span>
        </h1>

        <p class="text-stone-400 text-xs md:text-sm">
        
        </p>

        <div id="load-msg" class="mt-4 text-[11px] text-stone-300 hidden">
          データを読み込んでいます…
        </div>
      </div>
      <div class="absolute -right-20 -bottom-20 w-64 h-64 bg-amber-600/10 rounded-full blur-3xl"></div>
    </div>
  </header>

  <main class="max-w-4xl mx-auto px-4 -mt-8">

    <!-- Date Selector -->
    <div class="bg-white rounded-3xl p-3 shadow-2xl border border-stone-100 sticky top-4 z-50 mb-8">
      <div class="flex overflow-x-auto gap-2 no-scrollbar" id="date-tabs">
        <button onclick="changeDate('12/30')" class="date-btn flex-shrink-0 w-24 p-3 rounded-2xl bg-stone-50 hover:bg-stone-100 transition text-center">
          <div class="text-xs text-stone-500 font-bold">12/30</div>
          <div class="text-lg font-black">火</div>
        </button>
        <button onclick="changeDate('12/31')" class="date-btn flex-shrink-0 w-24 p-3 rounded-2xl bg-stone-50 hover:bg-stone-100 transition text-center">
          <div class="text-xs text-stone-500 font-bold">12/31</div>
          <div class="text-lg font-black">大晦日</div>
        </button>
        <button onclick="changeDate('1/1')" class="date-btn flex-shrink-0 w-24 p-3 rounded-2xl bg-stone-50 hover:bg-stone-100 transition text-center">
          <div class="text-xs text-stone-500 font-bold">1/1</div>
          <div class="text-lg font-black text-red-700">元旦</div>
        </button>
        <button onclick="changeDate('1/2')" class="date-btn flex-shrink-0 w-24 p-3 rounded-2xl bg-stone-50 hover:bg-stone-100 transition text-center">
          <div class="text-xs text-stone-500 font-bold">1/2</div>
          <div class="text-lg font-black">初売</div>
        </button>
        <button onclick="changeDate('1/3')" class="date-btn flex-shrink-0 w-24 p-3 rounded-2xl bg-stone-50 hover:bg-stone-100 transition text-center">
          <div class="text-xs text-stone-500 font-bold">1/3</div>
          <div class="text-lg font-black">土</div>
        </button>
        <button onclick="changeDate('1/4')" class="date-btn flex-shrink-0 w-24 p-3 rounded-2xl bg-stone-50 hover:bg-stone-100 transition text-center">
          <div class="text-xs text-stone-500 font-bold">1/4</div>
          <div class="text-lg font-black">日</div>
        </button>
      </div>
    </div>

    <!-- Error State -->
    <div id="error-state" class="hidden mb-6">
      <div class="bg-red-50 border border-red-200 text-red-800 rounded-2xl p-4 text-sm">
        CSVの読み込みに失敗しました。GitHub Pages上でCSVファイルが同階層に存在するか、ファイル名が一致しているかをご確認ください。
      </div>
    </div>

    <!-- Overview -->
    <section class="grid md:grid-cols-2 gap-6 mb-10">
      <div class="bg-white rounded-3xl p-6 shadow-lg border border-stone-100">
        <div class="flex items-end justify-between mb-4">
          <h2 class="text-lg font-black">本日の活気</h2>
          <div class="text-right">
            <div class="text-3xl font-black text-emerald-600" id="open-count">0</div>
            <div class="text-xs text-stone-400"><span id="total-count">0</span>件中 営業</div>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="openChart"></canvas>
        </div>
      </div>

      <div class="bg-white rounded-3xl p-6 shadow-lg border border-stone-100">
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="text-xs font-bold text-stone-400">今日のおすすめ</div>
            <div class="text-lg font-black mt-1" id="featured-name">—</div>
            <div class="text-sm text-stone-500 mt-1" id="featured-area">—</div>
          </div>
          <div class="text-right">
            <div class="text-xs font-bold text-stone-400">STATUS</div>
            <div class="text-base font-black mt-1" id="featured-status">—</div>
          </div>
        </div>
        <div class="mt-4 text-xs text-stone-500 leading-relaxed" id="featured-note"></div>
      </div>
    </section>

    <!-- Category Filters -->
    <section class="mb-6">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-base font-black">カテゴリ</h3>
        <div class="text-xs text-stone-400">タップで絞り込み</div>
      </div>
      <div class="flex flex-wrap gap-2" id="cat-buttons"></div>
    </section>

    <!-- List -->
    <section class="mb-16">
      <div class="bg-white rounded-3xl p-4 md:p-6 shadow-lg border border-stone-100">
        <div class="flex items-center justify-between mb-4">
          <div class="text-sm font-black">
            <span id="current-date">—</span> の営業状況
          </div>
          <div class="text-xs text-stone-400">
            <span id="shown-count">0</span>件表示
          </div>
        </div>
        <div class="space-y-3" id="shop-list"></div>
      </div>
    </section>

  </main>

  <script>
    // =========================
    // 1) Settings
    // =========================
    const CSV_PATH = "./%E3%80%902026%E3%80%91%E5%B9%B4%E6%9C%AB%E5%B9%B4%E5%A7%8B%E3%81%94%E8%BF%91%E6%89%80%E6%83%85%E5%A0%B1%20%20-%202025%E2%80%902026.csv";

    // =========================
    // 2) State
    // =========================
    let data = [];
    let curDate = "1/1";
    let curCat = "ALL";
    let chart;

    // =========================
    // 3) Helpers
    // =========================
    function normalizeStatus(s) {
      const t = (s || "").trim();
      if (!t) return "不明";
      if (t.includes("休")) return "休み";
      if (t.includes("営") || t.includes("OPEN") || t.includes("営業")) return "営業";
      return t;
    }

    function statusBadge(status) {
      const s = normalizeStatus(status);
      if (s === "営業") return `<span class="px-2 py-1 rounded-full text-[11px] font-bold bg-emerald-50 text-emerald-700 border border-emerald-200">営業</span>`;
      if (s === "休み") return `<span class="px-2 py-1 rounded-full text-[11px] font-bold bg-stone-100 text-stone-600 border border-stone-200">休業</span>`;
      return `<span class="px-2 py-1 rounded-full text-[11px] font-bold bg-amber-50 text-amber-800 border border-amber-200">${s}</span>`;
    }

    function splitNameAndUrl(raw) {
      const str = (raw || "").trim();
      const urlMatch = str.match(/https?:\/\/\S+/);
      if (!urlMatch) return { name: str, url: "" };
      const url = urlMatch[0].replace(/[),。、]\s*$/, "");
      const name = str.replace(urlMatch[0], "").trim();
      return { name: name || str, url };
    }

    // =========================
    // 4) Rendering
    // =========================
    function renderCatButtons() {
      const cats = Array.from(new Set(data.map(d => (d.cat || "").trim()).filter(Boolean)));
      const root = document.getElementById("cat-buttons");
      const mkBtn = (label, value) => {
        const active = (curCat === value);
        return `
          <button class="px-4 py-2 rounded-full text-xs font-bold border transition
            ${active ? "bg-stone-900 text-white border-stone-900" : "bg-white text-stone-700 border-stone-200 hover:bg-stone-50"}"
            onclick="setCat('${value}')">
            ${label}
          </button>`;
      };
      root.innerHTML = mkBtn("すべて", "ALL") + cats.map(c => mkBtn(c, c)).join("");
    }

    function setCat(cat) {
      curCat = cat;
      renderCatButtons();
      changeDate(curDate);
    }

    function pickFeatured(list) {
      if (!list.length) return null;
      const open = l


